From be8e47acf22b93c4b9072d63d3c6778502df0f44 Mon Sep 17 00:00:00 2001
From: Michael Natterer <mitch@gimp.org>
Date: Fri, 5 Oct 2012 12:10:15 +0200
Subject: [PATCH 19/21] quartz: enable the CALayer for each toplevel window

Enabling it later triggers ugly artifacts.
---
 gdk/quartz/GdkQuartzView.c    |    2 ++
 gdk/quartz/gdkwindow-quartz.c |    1 +
 2 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/gdk/quartz/GdkQuartzView.c b/gdk/quartz/GdkQuartzView.c
index 2a75da9..56307b9 100644
--- a/gdk/quartz/GdkQuartzView.c
+++ b/gdk/quartz/GdkQuartzView.c
@@ -136,6 +136,8 @@
       [[self window] invalidateShadow];
       needsInvalidateShadow = NO;
     }
+
+  [[self layer] removeAllAnimations];
 }
 
 -(void)setNeedsInvalidateShadow:(BOOL)invalidate
diff --git a/gdk/quartz/gdkwindow-quartz.c b/gdk/quartz/gdkwindow-quartz.c
index 8e12ae6..e0f78e0 100644
--- a/gdk/quartz/gdkwindow-quartz.c
+++ b/gdk/quartz/gdkwindow-quartz.c
@@ -1003,6 +1003,7 @@ _gdk_window_impl_new (GdkWindow     *window,
         content_rect.origin.y = 0;
 
 	impl->view = [[GdkQuartzView alloc] initWithFrame:content_rect];
+        [impl->view setWantsLayer:YES];
 	[impl->view setGdkWindow:window];
 	[impl->toplevel setContentView:impl->view];
 	[impl->view release];
-- 
1.7.5.4

